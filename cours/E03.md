# E03 : Auth et Role

---

## SQL : les requêtes préparées

La faille SQLi : `SQL injection` :

- Armand
  - Un utilisateur malveillant peut injecter des requêtes sql lors des interactions avec l'application (formulaire, URLs)
- Ludovic
  - Quand on envoie les données brut dans la requête : quand on ne valide pas les données, ou qu'on ne les sanitize pas.
- Julien
  - est un type d'attaque dans laquelle les cybercriminels tentent d'exploiter les vulnérabilités du code d'une application en insérant une requête SQL dans des champs de saisie ou de formulaire réguliers, ou les URLs.
- Sylvain
  - Il ne faut pas laisser mettre directement les éléments rentrés par l'user dans nos requetes SQL, il faut les securiser avant : avec des requêtes préparées et de la validation de données.
- Maeva
  - Les risque d'une injection SQL : de vol de données sensibles , modif ou suppression de données et manipulation dangereuse de la BDD.

```sql
INSERT INTO users (username, password) VALUES ('lorenzo', 'password');

const text = '; DELETE FROM users;'
PREPARE fooplan (int, text, bool, numeric) AS
    INSERT INTO users VALUES($1, $2, $3, $4);
EXECUTE fooplan(1, '; DELETE FROM users;', 't', 200.00);
```

```js
const username = req.body.username;
const password = req.body.password; // '; DELETE FROM users;
// pas bien
const query = `INSERT INTO users (username, password) VALUES (${name}, ${password});`
//  bien
const query = `INSERT INTO users (username, password) VALUES ($1, $2);`
const values = [username, password];
const res = await client.query(query, values);
//  bien
const query = {
    text: `INSERT INTO users (username, password) VALUES ($1, $2);`,
    values: [username, password]
}

const res = await client.query(query);
```
